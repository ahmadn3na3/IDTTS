<div class="card mb-3 shadow-sm border-start border-5" [ngClass]="getBorderClass()">
  <div class="card-body p-3">
    <div class="d-flex justify-content-between align-items-start mb-2">
      <span class="fw-bold text-secondary">#{{ task.id.slice(0, 8) }}</span>
      <span class="badge rounded-pill" [ngClass]="getPriorityBadgeClass()">
        {{ priorityMap[task.priority] }}
      </span>
    </div>

    <p class="mb-1 text-muted small">الطالب: <span class="fw-medium text-dark">{{ task.requestingParty }}</span></p>
    <p class="mb-1 text-muted small">القسم: <span class="fw-medium text-dark">{{ departmentMap[task.currentDepartment]
        }}</span></p>

    <div class="mt-2 d-flex justify-content-between small text-secondary">
      <span>المخطط: {{ task.plannedTime }} يوم</span>
      <span [class.fw-bold]="isDelayed()" [class.text-danger]="isDelayed()">الفعلي: {{ task.actualTime }} يوم</span>
    </div>

    <div *ngIf="task.obstacle" class="mt-2 p-2 bg-danger-subtle text-danger rounded small border border-danger-subtle">
      <strong>عقبة:</strong> {{ task.obstacle }}
    </div>

    <div class="mt-3 d-flex flex-wrap gap-2">
      <!-- Actions based on state -->
      <button *ngIf="task.status === TaskStatus.UNDER_REVIEW" (click)="onAction('approveCredit')"
        class="btn btn-sm btn-primary">
        موافقة الائتمان
      </button>

      <button *ngIf="task.currentDepartment === Department.PRODUCTION && task.status === TaskStatus.IN_PROGRESS"
        (click)="onAction('reportObstacle')" class="btn btn-sm btn-danger">
        إبلاغ عن عقبة
      </button>

      <button *ngIf="task.currentDepartment === Department.PRODUCTION && task.status === TaskStatus.IN_PROGRESS"
        (click)="onAction('completeProduction')" class="btn btn-sm btn-success">
        إكمال الإنتاج
      </button>

      <button *ngIf="task.status === TaskStatus.BLOCKED" (click)="onAction('resolveObstacle')"
        class="btn btn-sm btn-warning text-dark">
        حل العقبة
      </button>

      <button *ngIf="task.status === TaskStatus.COMPLETED" (click)="onAction('closeTask')" class="btn btn-sm btn-dark">
        إغلاق المهمة
      </button>
    </div>
  </div>
</div>