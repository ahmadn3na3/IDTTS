<div class="container-fluid py-4 bg-light min-vh-100">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 fw-bold text-dark">نظام تتبع المهام (IDTTS)</h1>
        <button (click)="createTask()" class="btn btn-primary shadow-sm">
            <i class="bi bi-plus-lg ms-1"></i> طلب جديد (المبيعات)
        </button>
    </div>

    <div class="d-flex overflow-auto pb-4 gap-3">
        <div *ngFor="let status of columns" class="min-vw-25 bg-white rounded shadow-sm p-3 border"
            style="min-width: 300px;">
            <h2 class="h6 fw-bold text-secondary mb-3 d-flex justify-content-between align-items-center">
                {{ statusMap[status] }}
                <span class="badge bg-light text-dark border">{{ getTasksByStatus(status).length }}</span>
            </h2>

            <div class="d-flex flex-column gap-2">
                <app-task-card *ngFor="let task of getTasksByStatus(status)" [task]="task" [currentUser]="currentUser"
                    [userMap]="userMap" (action)="handleAction($event, task)">
                </app-task-card>
            </div>
        </div>
    </div>

    <!-- Reason Modal -->
    <div class="modal fade show" tabindex="-1" *ngIf="showModal" style="display: block; background: rgba(0,0,0,0.5);"
        role="dialog">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">{{ modalTitle }}</h5>
                    <button type="button" class="btn-close" (click)="closeModal()"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="reasonInput" class="form-label" *ngIf="isObstacle">وصف العقبة (مطلوب)</label>
                        <label for="reasonInput" class="form-label" *ngIf="!isObstacle">السبب / الملاحظة</label>
                        <textarea class="form-control" id="reasonInput" rows="4" [(ngModel)]="modalReason"
                            placeholder="أدخل التفاصيل هنا..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" (click)="closeModal()">إلغاء</button>
                    <button type="button" class="btn btn-primary" (click)="confirmAction()"
                        [disabled]="isObstacle && !modalReason">حفظ</button>
                </div>
            </div>
        </div>
    </div>
</div>